name: "Test Compute Semver (Compairifuel/.github #21)"

on:
    workflow_dispatch:
        inputs:
            defaults:
                description: "Whether to test defaults test cases"
                required: true
                default: true
                type: boolean

jobs:
    test-defaults-patch-only:
        name: "GIVEN fix,docs,chore commits AND latest-tag=v0.0.0 AND is-trunk WHEN compute-semver THEN semver=v0.0.1 AND changelog only contains patch commits"
        runs-on: ubuntu-latest
        if: github.event.inputs.defaults == 'true'
        steps:
            - uses: actions/checkout@v6
            - uses: compairifuel/.github/actions/compute-semver@feat/semver-workflow
              name: Perform Test
              id: compute-semver
              with:
                commits: |
                    fix: fix bug
                    ==END==
                    docs: update documentation
                    ==END==
                    chore: update dependencies
                    ==END==
                latest-tag: v0.0.0
                is-trunk: true
            - name: Output Result
              run: |
                echo "Computed Semver: ${{ steps.compute-semver.outputs.semver }}"
                echo "Changelog: ${{ steps.compute-semver.outputs.changelog }}"

    test-defaults-minor-only:
        name: "GIVEN feat,feature commits AND latest-tag=v0.0.0 AND is-trunk WHEN compute-semver THEN semver=v0.1.0 AND changelog only contains minor commits"
        runs-on: ubuntu-latest
        if: github.event.inputs.defaults == 'true'
        steps:
            - uses: actions/checkout@v6
            - uses: compairifuel/.github/actions/compute-semver@feat/semver-workflow
              name: Perform Test
              id: compute-semver
              with:
                commits: |
                    feat: add new feature
                    ==END==
                    feature: improve existing feature
                    ==END==
                    feat: enhance performance
                    ==END==
                latest-tag: v0.0.0
                is-trunk: true
            - name: Output Result
              run: |
                echo "Computed Semver: ${{ steps.compute-semver.outputs.semver }}"
                echo "Changelog: ${{ steps.compute-semver.outputs.changelog }}"

    test-defaults-major-only:
        name: "GIVEN breaking changes AND latest-tag=v0.0.0 AND is-trunk WHEN compute-semver THEN semver=v1.0.0 AND changelog only contains major commits"
        runs-on: ubuntu-latest
        if: github.event.inputs.defaults == 'true'
        steps:
            - uses: actions/checkout@v6
            - uses: compairifuel/.github/actions/compute-semver@feat/semver-workflow
              name: Perform Test
              id: compute-semver
              with:
                commits: |
                    feat!: breaking change in feature
                    ==END==
                    fix!: breaking change in fix
                    ==END==
                    refactor!: breaking change in refactor
                    ==END==
                    feat: add a new feature

                    BREAKING CHANGE: this is a breaking change
                    ==END==
                latest-tag: v0.0.0
                is-trunk: true
            - name: Output Result
              run: |
                echo "Computed Semver: ${{ steps.compute-semver.outputs.semver }}"
                echo "Changelog: ${{ steps.compute-semver.outputs.changelog }}"
                
